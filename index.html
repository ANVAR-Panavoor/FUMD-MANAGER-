<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fund Manager Pro</title>
    <style>
        :root { --primary: #1a73e8; --income: #2ecc71; --expense: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .unit-header { text-align: center; font-weight: bold; padding: 12px; cursor: pointer; background: #e8f0fe; border-radius: 10px; margin-bottom: 20px; color: var(--primary); border: 2px dashed #1a73e8; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .card { padding: 15px; border-radius: 12px; color: white; text-align: center; font-size: 13px; font-weight: bold; }
        .card.in { background: var(--income); }
        .card.out { background: var(--expense); }
        .card.bal { background: var(--primary); }
        
        .tab-bar { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { padding: 10px 15px; border: none; border-radius: 8px; background: #ddd; cursor: pointer; flex: 1; min-width: 100px; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: white; }

        .section { background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 20px; display: none; }
        .section.active { display: block; }

        input, select, button { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .list-item { display: flex; justify-content: space-between; align-items: center; background: white; padding: 10px; border-radius: 8px; margin-bottom: 5px; border: 1px solid #eee; }
        .del-icon { color: #e74c3c; cursor: pointer; font-weight: bold; padding: 5px 10px; border: 1px solid #e74c3c; border-radius: 5px; width: auto !important; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .wa-single { background: #25D366; color: white; padding: 5px 8px; text-decoration: none; border-radius: 5px; font-size: 11px; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color: var(--primary); margin-bottom: 10px;">Fund Manager Pro</h2>
    <div class="unit-header" id="unitDisplay" onclick="editUnitName()">JSC Konganamkode Unit</div>
    
    <div class="dashboard">
        <div class="card in">വരവ്<br><span id="totalIn">0</span></div>
        <div class="card out">ചെലവ്<br><span id="totalOut">0</span></div>
        <div class="card bal">ബാക്കി<br><span id="balance">0</span></div>
    </div>

    <div class="tab-bar">
        <button class="tab-btn active" onclick="openTab('ledgerTab')">ഇടപാടുകൾ</button>
        <button class="tab-btn" onclick="openTab('memberTab')">മെമ്പർമാർ</button>
        <button class="tab-btn" onclick="openTab('itemTab')">ഇനങ്ങൾ</button>
        <button class="tab-btn" onclick="openTab('reportTab')" style="background: #25D366; color: white;">റിപ്പോർട്ട്</button>
    </div>

    <div id="ledgerTab" class="section active">
        <h3>പുതിയ എൻട്രി</h3>
        <input type="date" id="date">
        <select id="catSelect"></select>
        <select id="nameSelect"></select>
        <input type="number" id="amt" placeholder="തുക">
        <select id="type">
            <option value="income">വരവ് (In)</option>
            <option value="expense">ചെലവ് (Out)</option>
        </select>
        <button onclick="addEntry()">സേവ് ചെയ്യുക</button>

        <div style="overflow-x:auto;">
            <table>
                <thead><tr><th>വിവരം</th><th>തുക</th><th>Action</th></tr></thead>
                <tbody id="ledgerBody"></tbody>
            </table>
        </div>
    </div>

    <div id="memberTab" class="section">
        <h3>മെമ്പർമാരെ ചേർക്കുക</h3>
        <input type="text" id="mName" placeholder="പേര്">
        <input type="number" id="mPhone" placeholder="വാട്സാപ്പ് നമ്പർ">
        <button onclick="addMember()" style="background: var(--income);">Add Member</button>
        <div id="memberListUI" style="margin-top: 15px;"></div>
    </div>

    <div id="itemTab" class="section">
        <h3>ഫണ്ട് ഇനങ്ങൾ ചേർക്കുക</h3>
        <input type="text" id="newCat" placeholder="ഉദാ: മാസവരി, ഫണ്ട്">
        <button onclick="addCategory()" style="background: var(--income);">Add Category</button>
        <div id="categoryListUI" style="margin-top: 15px;"></div>
    </div>

    <div id="reportTab" class="section">
        <h3>റിപ്പോർട്ട് ഓപ്ഷനുകൾ</h3>
        <button onclick="shareFullReport()" style="background: #25D366; margin-bottom: 10px;">WhatsApp-ൽ അയക്കുക</button>
        <button onclick="exportToExcel()" style="background: #1d6f42;">Excel ഡൗൺലോഡ്</button>
    </div>

</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_pro_data')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_members')) || [];
    let categories = JSON.parse(localStorage.getItem('jsc_cats')) || ["മാസവരി", "ജിലാനി ഷെരീഫ്"];
    let unitName = localStorage.getItem('jsc_unit_title') || "JSC Konganamkode Unit";

    function openTab(tabId) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        renderAll();
    }

    function editUnitName() {
        let n = prompt("യൂണിറ്റ് പേര് മാറ്റുക:", unitName);
        if(n) { unitName = n; localStorage.setItem('unit_title', n
                                                   
