<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fund Manager Pro</title>
    <style>
        :root { --primary: #1a73e8; --income: #2ecc71; --expense: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .unit-header { text-align: center; font-weight: bold; padding: 12px; cursor: pointer; background: #e8f0fe; border-radius: 10px; margin-bottom: 20px; color: var(--primary); border: 2px dashed #1a73e8; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .card { padding: 15px; border-radius: 12px; color: white; text-align: center; font-size: 13px; font-weight: bold; }
        .card.in { background: var(--income); }
        .card.out { background: var(--expense); }
        .card.bal { background: var(--primary); }
        .section { background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 25px; }
        input, select, button { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .list-box { background: white; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; max-height: 180px; overflow-y: auto; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .report-selectors { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="unit-header" id="unitDisplay" onclick="editUnitName()">JSC Konganamkode Unit</div>
    
    <div class="dashboard">
        <div class="card in" style="background-color: var(--income)">‡¥µ‡¥∞‡¥µ‡µç<br><span id="totalIn">0</span></div>
        <div class="card out" style="background-color: var(--expense)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><span id="totalOut">0</span></div>
        <div class="card bal" style="background-color: var(--primary)">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><span id="balance">0</span></div>
    </div>

    <div class="section">
        <h3>‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Monthly & Annual)</h3>
        <div class="report-selectors no-print">
            <div>
                <small>‡¥Æ‡¥æ‡¥∏‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:</small>
                <input type="month" id="monthFilter" onchange="renderAll()">
            </div>
            <div>
                <small>‡¥µ‡µº‡¥∑‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï:</small>
                <select id="yearFilter" onchange="renderAll()">
                    <option value="">‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>
        </div>
        <div style="display: flex; gap: 5px;" class="no-print">
            <button onclick="shareFullReport()" style="background: #25D366;">WhatsApp Report</button>
            <button onclick="window.print()" style="background: #e74c3c;">Download PDF</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>‡¥µ‡¥ø‡¥µ‡¥∞‡¥Ç</th>
                    <th>‡¥§‡µÅ‡¥ï</th>
                    <th class="no-print">Action</th>
                </tr>
            </thead>
            <tbody id="ledgerBody"></tbody>
        </table>
    </div>

    <div class="section no-print">
        <h3>‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µç (New Entry)</h3>
        <input type="date" id="date">
        <select id="catSelect"></select>
        <select id="nameSelect"></select>
        <input type="number" id="amt" placeholder="‡¥§‡µÅ‡¥ï">
        <select id="type">
            <option value="income">‡¥µ‡¥∞‡¥µ‡µç (Cash Received ‚úÖ)</option>
            <option value="expense">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Payment Out ‚ùå)</option>
        </select>
        <button onclick="addEntry()">‡¥∏‡µá‡¥µ‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥∞‡¥∏‡µÄ‡¥§‡µç ‡¥Ö‡¥Ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï</button>
    </div>

    <div class="section no-print">
        <h3>‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº & ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ</h3>
        <div id="memberListUI" class="list-box"></div>
        <input type="text" id="mName" placeholder="‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº ‡¥™‡µá‡¥∞‡µç">
        <input type="number" id="mPhone" placeholder="‡¥´‡µã‡µ∫">
        <button onclick="addMember()" style="background: var(--income);">Add Member</button>
        
        <div id="categoryListUI" class="list-box" style="margin-top: 20px;"></div>
        <input type="text" id="newCat" placeholder="‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥®‡¥Ç">
        <button onclick="addCategory()" style="background: var(--income);">Add Item</button>
    </div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_pro_data')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_members')) || [];
    let categories = JSON.parse(localStorage.getItem('jsc_cats')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø", "‡¥ú‡¥ø‡¥≤‡¥æ‡¥®‡¥ø ‡¥∑‡µÜ‡¥∞‡µÄ‡¥´‡µç"];
    let unitName = localStorage.getItem('unit_title') || "JSC Konganamkode Unit";

    function editUnitName() {
        let n = prompt("Unit Name:", unitName);
        if(n) { unitName = n; localStorage.setItem('unit_title', n); renderAll(); }
    }

    function renderAll() {
        document.getElementById('unitDisplay').innerText = unitName;
        
        // ‡¥ü‡µã‡¥™‡µç‡¥™‡¥ø‡¥≤‡µÜ ‡¥á‡¥®‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥Ç ‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡¥∞‡µÅ‡¥Ç ‡¥Ö‡¥™‡µç‚Äå‡¥°‡µá‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï
        document.getElementById('categoryListUI').innerHTML = categories.map((c, i) => `<div class="list-item">${c} <span style="color:red; cursor:pointer;" onclick="deleteCategory(${i})">X</span></div>`).join('');
        document.getElementById('memberListUI').innerHTML = members.map((m, i) => `<div class="list-item">${m.name} <span style="color:red; cursor:pointer;" onclick="deleteMember(${i})">X</span></div>`).join('');
        document.getElementById('catSelect').innerHTML = '<option value="">‡¥á‡¥®‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('nameSelect').innerHTML = '<option value="">‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + members.map(m => `<option value="${m.name}|${m.phone}">${m.name}</option>`).join('');

        const monthVal = document.getElementById('monthFilter').value;
        const yearVal = document.getElementById('yearFilter').value;
        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';
        
        let tin = 0, tout = 0;

        // ‡¥´‡¥ø‡µΩ‡¥ü‡µç‡¥ü‡¥±‡¥ø‡¥Ç‡¥ó‡µç ‡¥≤‡µã‡¥ú‡¥ø‡¥ï‡µç
        const filtered = entries.filter(e => {
            const matchMonth = monthVal ? e.date.startsWith(monthVal) : true;
            const matchYear = yearVal ? e.date.startsWith(yearVal) : true;
            return matchMonth && matchYear;
        });

        filtered.slice().reverse().forEach((e, i) => {
            let isInc = e.type === 'income';
            if(isInc) tin += parseFloat(e.amt); else tout += parseFloat(e.amt);
            
            tbody.innerHTML += `<tr>
                <td><b>${e.name}</b><br><small>${e.date} | ${e.category} ${isInc ? '‚úÖ' : '‚ùå'}</small></td>
                <td style="color:${isInc ? 'green' : 'red'}">‚Çπ${e.amt}</td>
                <td class="no-print"><span onclick="deleteEntry(${entries.indexOf(e)})" style="color:red; cursor:pointer;">üóëÔ∏è</span></td>
            </tr>`;
        });

        document.getElementById('totalIn').innerText = tin;
        document.getElementById('totalOut').innerText = tout;
        document.getElementById('balance').innerText = tin - tout;
    }

    function addEntry() {
        const d = document.getElementById('date').value;
        const c = document.getElementById('catSelect').value;
        const m = document.getElementById('nameSelect').value.split('|');
        const a = document.getElementById('amt').value;
        const t = document.getElementById('type').value;
        if(d && c && m[0] && a) {
            entries.push({date:d, category:c, name:m[0], phone:m[1], amt:a, type:t});
            localStorage.setItem('jsc_pro_data', JSON.stringify(entries));
            renderAll();
            let msg = `*${unitName}*\n\n‡¥™‡µç‡¥∞‡¥ø‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥∏‡µç‡¥µ‡µÄ‡¥ï‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
            window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
        }
    }

    function addMember() {
        let n = document.getElementById('mName').value;
        let p = document.getElementById('mPhone').value;
        if(n && p) { members.push({name:n, phone:p}); localStorage.setItem('jsc_members', JSON.stringify(members)); renderAll(); }
    }

    function addCategory() {
        let c = document.getElementById('newCat').value;
        if(c) { categories.push(c); localStorage.setItem('jsc_cats', JSON.stringify(categories)); renderAll(); }
    }

    function deleteEntry(i) { if(confirm("‡¥°‡¥ø‡¥≤‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã?")) { entries.splice(i,1); localStorage.setItem('jsc_pro_data',JSON.stringify(entries)); renderAll(); } }
    function deleteMember(i) { members.splice(i,1); localStorage.setItem('jsc_members',JSON.stringify(members)); renderAll(); }
    function deleteCategory(i) { categories.splice(i,1); localStorage.setItem('jsc_cats',JSON.stringify(categories)); renderAll(); }

    function shareFullReport() {
        let txt = `*${unitName} - ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç*\n‡¥µ‡¥∞‡¥µ‡µç: ‚Çπ${document.getElementById('totalIn').innerText} ‚úÖ\n‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${document.getElementById('totalOut').innerText} ‚ùå\n‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø: ‚Çπ${document.getElementById('balance').innerText}\n\n*‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥§‡¥æ‡¥¥‡µÜ:*`;
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    renderAll();
</script>
</body>
</html>
