<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSC Fund Manager Pro</title>
    <style>
        :root { --primary: #1a73e8; --income: #2ecc71; --expense: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; }
        
        .unit-header { text-align: center; font-weight: bold; padding: 15px; background: white; border-radius: 15px; margin-bottom: 15px; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; }

        /* ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µç ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡µΩ */
        .collapsible-card { background: white; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
        .card-header { padding: 20px; background: #fff; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f2f5; }
        .card-header h2 { margin: 0; font-size: 18px; color: #333; }
        .card-content { padding: 20px; display: none; background: #fff; }
        .arrow { transition: 0.3s; font-weight: bold; color: #888; }
        
        /* ‡¥§‡µÅ‡¥±‡¥ï‡µç‡¥ï‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥â‡¥≥‡µç‡¥≥ ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç */
        .active-card .card-content { display: block; }
        .active-card .arrow { transform: rotate(180deg); }

        /* ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ü‡¥æ‡¥¨‡µÅ‡¥ï‡µæ */
        .report-tabs { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; }
        .tab-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 13px; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { padding: 10px; border-radius: 10px; color: white; text-align: center; font-size: 12px; font-weight: bold; }

        input, select, button { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .list-box { background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #eee; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        .del-btn { color: red; font-weight: bold; cursor: pointer; padding: 5px; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #eee; }
        
        .filter-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        
        @media print { .no-print, .card-header { display: none !important; } .card-content { display: block !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="unit-header" id="unitDisplay" onclick="editUnitName()">JSC Konganamkode Unit</div>

    <div class="collapsible-card" id="card-reports">
        <div class="card-header" onclick="toggleCard('card-reports')">
            <h2>üìä ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Reports)</h2>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div class="report-tabs no-print">
                <button class="tab-btn active" onclick="switchReport('all', this)">‡¥Ü‡¥ï‡µÜ ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç</button>
                <button class="tab-btn" onclick="switchReport('income', this)">‡¥µ‡¥∞‡¥µ‡µç ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç</button>
                <button class="tab-btn" onclick="switchReport('expense', this)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç</button>
            </div>
            <div class="filter-row no-print">
                <input type="month" id="monthFilter" onchange="renderAll()">
                <select id="yearFilter" onchange="renderAll()">
                    <option value="">‡¥µ‡µº‡¥∑‡¥Ç (‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥Ç)</option>
                    <option value="2025">2025</option>
                    <option value="2026">2026</option>
                </select>
            </div>
            <div class="dashboard">
                <div class="stat-card" style="background: var(--income)">‡¥µ‡¥∞‡¥µ‡µç<br><span id="totalIn">0</span></div>
                <div class="stat-card" style="background: var(--expense)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><span id="totalOut">0</span></div>
                <div class="stat-card" style="background: var(--primary)">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><span id="balance">0</span></div>
            </div>
            <div style="overflow-x:auto;">
                <table>
                    <thead><tr><th>‡¥µ‡¥ø‡¥µ‡¥∞‡¥Ç</th><th>‡¥§‡µÅ‡¥ï</th><th class="no-print"></th></tr></thead>
                    <tbody id="ledgerBody"></tbody>
                </table>
            </div>
            <div class="filter-row no-print" style="margin-top:15px;">
                <button onclick="shareReport()" style="background: #25D366;">WhatsApp Share</button>
                <button onclick="window.print()" style="background: #e74c3c;">Save PDF</button>
            </div>
        </div>
    </div>

    <div class="collapsible-card" id="card-add">
        <div class="card-header" onclick="toggleCard('card-add')">
            <h2>üìù ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µç (Add Entry)</h2>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <input type="date" id="date">
            <select id="catSelect"></select>
            <select id="nameSelect"></select>
            <input type="number" id="amt" placeholder="‡¥§‡µÅ‡¥ï">
            <select id="type">
                <option value="income">‡¥µ‡¥∞‡¥µ‡µç (Income ‚úÖ)</option>
                <option value="expense">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Expense ‚ùå)</option>
            </select>
            <button onclick="addEntry()">‡¥∏‡µá‡¥µ‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥∞‡¥∏‡µÄ‡¥§‡µç ‡¥Ö‡¥Ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï</button>
        </div>
    </div>

    <div class="collapsible-card" id="card-items">
        <div class="card-header" onclick="toggleCard('card-items')">
            <h2>üìÇ ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ (Categories)</h2>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div id="categoryListUI" class="list-box"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="newCat" placeholder="‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥®‡¥Ç">
                <button onclick="addCategory()" style="width:80px; background:var(--income);">Add</button>
            </div>
        </div>
    </div>

    <div class="collapsible-card" id="card-members">
        <div class="card-header" onclick="toggleCard('card-members')">
            <h2>üë• ‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº (Members)</h2>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div id="memberListUI" class="list-box"></div>
            <input type="text" id="mName" placeholder="‡¥™‡µá‡¥∞‡µç">
            <input type="number" id="mPhone" placeholder="WhatsApp ‡¥®‡¥Æ‡µç‡¥™‡µº">
            <button onclick="addMember()" style="background:var(--income);">Add Member</button>
        </div>
    </div>

</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_pro_data')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_members')) || [];
    let categories = JSON.parse(localStorage.getItem('jsc_cats')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø", "‡¥ú‡¥ø‡¥≤‡¥æ‡¥®‡¥ø ‡¥∑‡µÜ‡¥∞‡µÄ‡¥´‡µç"];
    let unitName = localStorage.getItem('unit_title') || "JSC Konganamkode Unit";
    let currentReportType = 'all';

    function toggleCard(cardId) {
        const card = document.getElementById(cardId);
        card.classList.toggle('active-card');
    }

    function switchReport(type, btn) {
        currentReportType = type;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderAll();
    }

    function renderAll() {
        document.getElementById('unitDisplay').innerText = unitName;
        document.getElementById('categoryListUI').innerHTML = categories.map((c, i) => `<div class="list-item">${c} <span class="del-btn" onclick="deleteCategory(${i})">‚úï</span></div>`).join('');
        document.getElementById('memberListUI').innerHTML = members.map((m, i) => `<div class="list-item">${m.name} <span class="del-btn" onclick="deleteMember(${i})">‚úï</span></div>`).join('');
        document.getElementById('catSelect').innerHTML = '<option value="">‡¥á‡¥®‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('nameSelect').innerHTML = '<option value="">‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + members.map(m => `<option value="${m.name}|${m.phone}">${m.name}</option>`).join('');

        const month = document.getElementById('monthFilter').value;
        const year = document.getElementById('yearFilter').value;
        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';
        let tin = 0, tout = 0;

        entries.forEach((e, idx) => {
            const dateMatch = (month ? e.date.startsWith(month) : true) && (year ? e.date.startsWith(year) : true);
            const typeMatch = (currentReportType === 'all') || (e.type === currentReportType);

            if (dateMatch && typeMatch) {
                let isInc = e.type === 'income';
                if(isInc) tin += parseFloat(e.amt); else tout += parseFloat(e.amt);
                let row = `<tr>
                    <td><b>${e.name}</b><br><small>${e.date} | ${e.category}</small></td>
                    <td style="color:${isInc?'green':'red'}">‚Çπ${e.amt}</td>
                    <td class="no-print"><span onclick="deleteEntry(${idx})" style="color:red; cursor:pointer;">üóëÔ∏è</span></td>
                </tr>`;
                tbody.insertAdjacentHTML('afterbegin', row);
            }
        });
        document.getElementById('totalIn').innerText = tin;
        document.getElementById('totalOut').innerText = tout;
        document.getElementById('balance').innerText = tin - tout;
    }

    function addEntry() {
        const d = document.getElementById('date').value;
        const c = document.getElementById('catSelect').value;
        const m = document.getElementById('nameSelect').value.split('|');
        const a = document.getElementById('amt').value;
        const t = document.getElementById('type').value;
        if(d && c && m[0] && a) {
            entries.push({date:d, category:c, name:m[0], phone:m[1], amt:a, type:t});
            localStorage.setItem('jsc_pro_data', JSON.stringify(entries));
            renderAll();
            if(confirm("‡¥∏‡µá‡¥µ‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µÅ! ‡¥∞‡¥∏‡µÄ‡¥§‡µç ‡¥Ö‡¥Ø‡¥ï‡µç‡¥ï‡¥£‡µã?")) {
                let msg = `*${unitName}*\n\n‡¥™‡µç‡¥∞‡¥ø‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥µ‡¥∞‡¥µ‡µç ‡¥µ‡µÜ‡¥ö‡µç‡¥ö‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µç. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
                window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
            }
        } else { alert("‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥™‡µÇ‡µº‡¥£‡µç‡¥£‡¥Æ‡¥≤‡µç‡¥≤!"); }
    }

    function shareReport() {
        let month = document.getElementById('monthFilter').value;
        let txt = `*${unitName} - ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ${month || ""}*\n\n‡¥µ‡¥∞‡¥µ‡µç: ‚Çπ${document.getElementById('totalIn').innerText} ‚úÖ\n‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${document.getElementById('totalOut').innerText} ‚ùå\n‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø: ‚Çπ${document.getElementById('balance').innerText}\n\nJSC Pro ‡¥µ‡¥¥‡¥ø ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥ï‡µç‡¥ï‡¥ø‡¥Ø‡¥§‡µç.`;
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    function addMember() {
        let n = document.getElementById('mName').value;
        let p = document.getElementById('mPhone').value;
        if(n && p) { members.push({name:n, phone:p}); localStorage.setItem('jsc_members', JSON.stringify(members)); renderAll(); }
    }

    function addCategory() {
        let c = document.getElementById('newCat').value;
        if(c) { categories.push(c); localStorage.setItem('jsc_cats', JSON.stringify(categories)); renderAll(); }
    }

    function deleteEntry(i) { if(confirm("‡¥°‡¥ø‡¥≤‡µÄ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥£‡µã?")) { entries.splice(i,1); localStorage.setItem('jsc_pro_data',JSON.stringify(entries)); renderAll(); } }
    function deleteMember(i) { if(confirm("‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥£‡µã?")) { members.splice(i,1); localStorage.setItem('jsc_members',JSON.stringify(members)); renderAll(); } }
    function deleteCategory(i) { if(confirm("‡¥á‡¥®‡¥Ç ‡¥í‡¥¥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥£‡µã?")) { categories.splice(i,1); localStorage.setItem('jsc_cats',JSON.stringify(categories)); renderAll(); } }
    function editUnitName() { let n = prompt("‡¥Ø‡µÇ‡¥£‡¥ø‡¥±‡µç‡¥±‡µç ‡¥™‡µá‡¥∞‡µç:", unitName); if(n) { unitName = n; localStorage.setItem('unit_title', n); renderAll(); } }

    renderAll();
</script>
</body>
</html>

