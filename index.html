<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fund Manager Pro</title>
    <style>
        :root { --primary: #075e54; --income: #25d366; --expense: #e74c3c; --bg: #ece5dd; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; }
        
        /* ‡¥π‡µÜ‡¥°‡µº */
        .header { 
            background: var(--primary); color: white; padding: 20px; 
            border-radius: 15px; text-align: center; margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer;
        }

        /* ‡¥ï‡¥æ‡µº‡¥°‡µÅ‡¥ï‡µæ */
        .card { 
            background: white; border-radius: 15px; margin-bottom: 12px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden;
        }
        .card-header { 
            padding: 15px 20px; cursor: pointer; display: flex; 
            justify-content: space-between; align-items: center;
            border-bottom: 1px solid #f0f0f0; font-weight: bold; color: #444;
        }
        .card-content { padding: 15px; display: none; }
        .active .card-content { display: block; }
        .active .arrow { transform: rotate(180deg); }
        .arrow { transition: 0.3s; color: #999; }

        /* ‡¥°‡¥æ‡¥∑‡µç‡¥¨‡µã‡µº‡¥°‡µç */
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .stat-box { padding: 10px; border-radius: 10px; color: white; text-align: center; font-size: 11px; }

        /* ‡¥á‡µª‡¥™‡µÅ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ */
        input, select, button { 
            padding: 12px; border: 1px solid #ddd; border-radius: 10px; 
            font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; 
        }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        /* ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç */
        .list-box { background: #f9f9f9; border-radius: 10px; max-height: 200px; overflow-y: auto; margin-bottom: 10px; }
        .list-item { 
            display: flex; justify-content: space-between; padding: 10px 15px; 
            border-bottom: 1px solid #eee; font-size: 14px; align-items: center;
        }

        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        td { padding: 10px 5px; border-bottom: 1px solid #f5f5f5; }
        
        .no-print { display: block; }
        @media print { .no-print { display: none !important; } .card-content { display: block !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header" onclick="editUnitName()">
        <h2 id="unitTitle" style="margin:0; font-size: 20px;">JSC KONGANAMKODE UNIT</h2>
        <small>Fund Manager Pro</small>
    </div>

    <div class="card" id="c1">
        <div class="card-header" onclick="toggle('c1')">
            <span>üìä ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Reports)</span>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div class="stats">
                <div class="stat-box" style="background:var(--income)">‡¥µ‡¥∞‡¥µ‡µç<br><b id="totalIn">0</b></div>
                <div class="stat-box" style="background:var(--expense)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><b id="totalOut">0</b></div>
                <div class="stat-box" style="background:var(--primary)">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><b id="balance">0</b></div>
            </div>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="month" id="monthFilter" onchange="render()">
                <button onclick="window.print()" style="background:#555; width:80px;">PDF</button>
            </div>
            <table>
                <tbody id="ledgerBody"></tbody>
            </table>
            <button onclick="shareReport()" style="background:#25d366; margin-top:10px;">WhatsApp-‡µΩ ‡¥Ö‡¥Ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï</button>
        </div>
    </div>

    <div class="card" id="c2">
        <div class="card-header" onclick="toggle('c2')">
            <span>üìù ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µç (New Entry)</span>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <input type="date" id="date">
            <select id="catSelect"></select>
            <select id="nameSelect"></select>
            <input type="number" id="amt" placeholder="‡¥§‡µÅ‡¥ï (Amount)">
            <select id="type">
                <option value="income">‡¥µ‡¥∞‡¥µ‡µç (Income ‚úÖ)</option>
                <option value="expense">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Expense ‚ùå)</option>
            </select>
            <button onclick="addEntry()">Save & Send Receipt</button>
        </div>
    </div>

    <div class="card" id="c3">
        <div class="card-header" onclick="toggle('c3')">
            <span>üìÇ ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ (Items)</span>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div id="catUI" class="list-box"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="newCat" placeholder="‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥®‡¥Ç">
                <button onclick="addCat()" style="width:70px; background:var(--income)">Add</button>
            </div>
        </div>
    </div>

    <div class="card" id="c4">
        <div class="card-header" onclick="toggle('c4')">
            <span>üë• ‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº (Members)</span>
            <span class="arrow">‚ñº</span>
        </div>
        <div class="card-content">
            <div id="memUI" class="list-box"></div>
            <input type="text" id="mName" placeholder="‡¥™‡µá‡¥∞‡µç">
            <input type="number" id="mPhone" placeholder="‡¥´‡µã‡µ∫ ‡¥®‡¥Æ‡µç‡¥™‡µº">
            <button onclick="addMem()" style="background:var(--income)">Add Member</button>
        </div>
    </div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_data_v1')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_mems_v1')) || [];
    let cats = JSON.parse(localStorage.getItem('jsc_cats_v1')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø"];
    let unit = localStorage.getItem('jsc_unit_v1') || "JSC KONGANAMKODE UNIT";

    function toggle(id) { document.getElementById(id).classList.toggle('active'); }

    function render() {
        document.getElementById('unitTitle').innerText = unit;
        document.getElementById('catUI').innerHTML = cats.map((c, i) => `<div class="list-item">${c} <span onclick="delCat(${i})" style="color:red">‚úï</span></div>`).join('');
        document.getElementById('memUI').innerHTML = members.map((m, i) => `<div class="list-item">${m.name} <span onclick="delMem(${i})" style="color:red">‚úï</span></div>`).join('');
        
        document.getElementById('catSelect').innerHTML = '<option value="">‡¥á‡¥®‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + cats.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('nameSelect').innerHTML = '<option value="">‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + members.map(m => `<option value="${m.name}|${m.phone}">${m.name}</option>`).join('');

        const month = document.getElementById('monthFilter').value;
        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';
        let tin = 0, tout = 0;

        entries.filter(e => month ? e.date.startsWith(month) : true).reverse().forEach((e, i) => {
            let isInc = e.type === 'income';
            if(isInc) tin += parseFloat(e.amt); else tout += parseFloat(e.amt);
            tbody.innerHTML += `<tr>
                <td><b>${e.name}</b><br><small>${e.date} | ${e.category}</small></td>
                <td style="color:${isInc?'green':'red'}">‚Çπ${e.amt} ${isInc?'‚úÖ':'‚ùå'}</td>
                <td><span onclick="delEntry(${entries.indexOf(e)})">üóëÔ∏è</span></td>
            </tr>`;
        });
        document.getElementById('totalIn').innerText = tin;
        document.getElementById('totalOut').innerText = tout;
        document.getElementById('balance').innerText = tin - tout;
    }

    function addEntry() {
        const d = document.getElementById('date').value;
        const c = document.getElementById('catSelect').value;
        const m = document.getElementById('nameSelect').value.split('|');
        const a = document.getElementById('amt').value;
        const t = document.getElementById('type').value;
        if(d && c && m[0] && a) {
            entries.push({date:d, category:c, name:m[0], phone:m[1], amt:a, type:t});
            localStorage.setItem('jsc_data_v1', JSON.stringify(entries));
            render();
            if(confirm("Saved! Send to WhatsApp?")) {
                let msg = `*${unit}*\n\nHi ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥≤‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µÅ. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
                window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
            }
        }
    }

    function shareReport() {
        let txt = `*${unit} - ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç*\n\n‡¥µ‡¥∞‡¥µ‡µç: ‚Çπ${document.getElementById('totalIn').innerText}\n‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${document.getElementById('totalOut').innerText}\n‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø: ‚Çπ${document.getElementById('balance').innerText}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    function addMem() {
        let n = document.getElementById('mName').value;
        let p = document.getElementById('mPhone').value;
        if(n && p) { members.push({name:n, phone:p}); localStorage.setItem('jsc_mems_v1', JSON.stringify(members)); render(); }
    }

    function addCat() {
        let c = document.getElementById('newCat').value;
        if(c) { cats.push(c); localStorage.setItem('jsc_cats_v1', JSON.stringify(cats)); render(); }
    }

    function delEntry(i) { if(confirm("Delete?")) { entries.splice(i,1); localStorage.setItem('jsc_data_v1', JSON.stringify(entries)); render(); } }
    function delMem(i) { members.splice(i,1); localStorage.setItem('jsc_mems_v1', JSON.stringify(members)); render(); }
    function delCat(i) { cats.splice(i,1); localStorage.setItem('jsc_cats_v1', JSON.stringify(cats)); renderAll(); }
    function editUnitName() { let n = prompt("Unit Name:", unit); if(n) { unit = n; localStorage.setItem('jsc_unit_v1', n); render(); } }

    render();
</script>
</body>
</html>
