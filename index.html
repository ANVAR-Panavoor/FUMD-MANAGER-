<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSC Fund Manager Pro</title>
    <style>
        :root { --primary: #1a73e8; --income: #2ecc71; --expense: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; }
        .unit-header { text-align: center; font-weight: bold; padding: 15px; background: white; border-radius: 15px; margin-bottom: 15px; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        /* ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µÅ‡¥ï‡µæ */
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 20px; }
        .main-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #333; border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; }

        /* ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ü‡¥æ‡¥¨‡µÅ‡¥ï‡µæ */
        .report-tabs { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { padding: 10px 15px; border-radius: 20px; border: none; background: #e8f0fe; color: var(--primary); font-weight: bold; cursor: pointer; white-space: nowrap; }
        .tab-btn.active { background: var(--primary); color: white; }

        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-card { padding: 10px; border-radius: 10px; color: white; text-align: center; font-size: 12px; font-weight: bold; }
        
        input, select, button { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        .list-box { background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; max-height: 150px; overflow-y: auto; border: 1px solid #eee; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        .del-btn { color: red; font-weight: bold; cursor: pointer; padding: 5px; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; margin-top: 10px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #eee; }
        
        .filter-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .no-print { display: block; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="unit-header" id="unitDisplay" onclick="editUnitName()">JSC Konganamkode Unit</div>

    <div class="main-card">
        <h3>‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Reports)</h3>
        <div class="report-tabs no-print">
            <button class="tab-btn active" onclick="switchReport('all', this)">Total Report</button>
            <button class="tab-btn" onclick="switchReport('income', this)">Income Only</button>
            <button class="tab-btn" onclick="switchReport('expense', this)">Expense Only</button>
        </div>

        <div class="filter-row no-print">
            <input type="month" id="monthFilter" onchange="renderAll()">
            <select id="yearFilter" onchange="renderAll()">
                <option value="">Yearly (All)</option>
                <option value="2025">2025</option>
                <option value="2026">2026</option>
            </select>
        </div>

        <div class="dashboard">
            <div class="stat-card" style="background: var(--income)">‡¥µ‡¥∞‡¥µ‡µç<br><span id="totalIn">0</span></div>
            <div class="stat-card" style="background: var(--expense)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><span id="totalOut">0</span></div>
            <div class="stat-card" style="background: var(--primary)">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><span id="balance">0</span></div>
        </div>

        <div style="overflow-x:auto;">
            <table id="reportTable">
                <thead><tr><th>‡¥µ‡¥ø‡¥µ‡¥∞‡¥Ç</th><th>‡¥§‡µÅ‡¥ï</th><th class="no-print"></th></tr></thead>
                <tbody id="ledgerBody"></tbody>
            </table>
        </div>
        
        <div class="filter-row no-print" style="margin-top:15px;">
            <button onclick="shareReport()" style="background: #25D366;">Share on WhatsApp</button>
            <button onclick="window.print()" style="background: #e74c3c;">Save as PDF</button>
        </div>
    </div>

    <br>

    <div class="main-card no-print">
        <h3>‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µç (Add Entry)</h3>
        <input type="date" id="date">
        <select id="catSelect"></select>
        <select id="nameSelect"></select>
        <input type="number" id="amt" placeholder="Amount (‡¥§‡µÅ‡¥ï)">
        <select id="type">
            <option value="income">‡¥µ‡¥∞‡¥µ‡µç (Income ‚úÖ)</option>
            <option value="expense">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Expense ‚ùå)</option>
        </select>
        <button onclick="addEntry()">Save Transaction</button>
    </div>

    <br>

    <div class="main-card no-print">
        <h3>‡¥´‡¥£‡µç‡¥ü‡µç ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ (Categories)</h3>
        <div id="categoryListUI" class="list-box"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="newCat" placeholder="New Category">
            <button onclick="addCategory()" style="width:100px; background:var(--income);">Add</button>
        </div>
    </div>

    <br>

    <div class="main-card no-print">
        <h3>‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº (Members)</h3>
        <div id="memberListUI" class="list-box"></div>
        <input type="text" id="mName" placeholder="Name">
        <input type="number" id="mPhone" placeholder="WhatsApp Number">
        <button onclick="addMember()" style="background:var(--income);">Add Member</button>
    </div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_pro_data')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_members')) || [];
    let categories = JSON.parse(localStorage.getItem('jsc_cats')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø", "‡¥ú‡¥ø‡¥≤‡¥æ‡¥®‡¥ø ‡¥∑‡µÜ‡¥∞‡µÄ‡¥´‡µç"];
    let unitName = localStorage.getItem('unit_title') || "JSC Konganamkode Unit";
    let currentReportType = 'all';

    function switchReport(type, btn) {
        currentReportType = type;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderAll();
    }

    function renderAll() {
        document.getElementById('unitDisplay').innerText = unitName;
        
        // Render Lists
        document.getElementById('categoryListUI').innerHTML = categories.map((c, i) => `<div class="list-item">${c} <span class="del-btn" onclick="deleteCategory(${i})">‚úï</span></div>`).join('');
        document.getElementById('memberListUI').innerHTML = members.map((m, i) => `<div class="list-item">${m.name} <span class="del-btn" onclick="deleteMember(${i})">‚úï</span></div>`).join('');
        
        // Update Selects
        document.getElementById('catSelect').innerHTML = '<option value="">Select Category</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('nameSelect').innerHTML = '<option value="">Select Member</option>' + members.map(m => `<option value="${m.name}|${m.phone}">${m.name}</option>`).join('');

        const month = document.getElementById('monthFilter').value;
        const year = document.getElementById('yearFilter').value;
        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';

        let tin = 0, tout = 0;

        entries.forEach((e, idx) => {
            const dateMatch = (month ? e.date.startsWith(month) : true) && (year ? e.date.startsWith(year) : true);
            const typeMatch = (currentReportType === 'all') || (e.type === currentReportType);

            if (dateMatch && typeMatch) {
                let isInc = e.type === 'income';
                if(isInc) tin += parseFloat(e.amt); else tout += parseFloat(e.amt);

                let row = `<tr>
                    <td><b>${e.name}</b><br><small>${e.date} | ${e.category} ${isInc?'‚úÖ':'‚ùå'}</small></td>
                    <td style="color:${isInc?'green':'red'}">‚Çπ${e.amt}</td>
                    <td class="no-print"><span onclick="deleteEntry(${idx})" style="color:red; cursor:pointer;">üóëÔ∏è</span></td>
                </tr>`;
                tbody.insertAdjacentHTML('afterbegin', row);
            }
        });

        document.getElementById('totalIn').innerText = tin;
        document.getElementById('totalOut').innerText = tout;
        document.getElementById('balance').innerText = tin - tout;
    }

    function addEntry() {
        const d = document.getElementById('date').value;
        const c = document.getElementById('catSelect').value;
        const m = document.getElementById('nameSelect').value.split('|');
        const a = document.getElementById('amt').value;
        const t = document.getElementById('type').value;
        if(d && c && m[0] && a) {
            entries.push({date:d, category:c, name:m[0], phone:m[1], amt:a, type:t});
            localStorage.setItem('jsc_pro_data', JSON.stringify(entries));
            renderAll();
            if(confirm("Saved! Send receipt to WhatsApp?")) {
                let msg = `*${unitName}*\n\n‡¥™‡µç‡¥∞‡¥ø‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥µ‡¥∞‡¥µ‡µç ‡¥µ‡µÜ‡¥ö‡µç‡¥ö‡¥ø‡¥ü‡µç‡¥ü‡µÅ‡¥£‡µç‡¥ü‡µç. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
                window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
            }
        }
    }

    function shareReport() {
        let month = document.getElementById('monthFilter').value;
        let title = currentReportType.toUpperCase() + " REPORT " + (month || "");
        let txt = `*${unitName} - ${title}*\n\nTotal In: ‚Çπ${document.getElementById('totalIn').innerText}\nTotal Out: ‚Çπ${document.getElementById('totalOut').innerText}\nBalance: ‚Çπ${document.getElementById('balance').innerText}\n\nGenerated by JSC Pro.`;
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    function addMember() {
        let n = document.getElementById('mName').value;
        let p = document.getElementById('mPhone').value;
        if(n && p) { members.push({name:n, phone:p}); localStorage.setItem('jsc_members', JSON.stringify(members)); renderAll(); }
    }

    function addCategory() {
        let c = document.getElementById('newCat').value;
        if(c) { categories.push(c); localStorage.setItem('jsc_cats', JSON.stringify(categories)); renderAll(); }
    }

    function deleteEntry(i) { if(confirm("Delete?")) { entries.splice(i,1); localStorage.setItem('jsc_pro_data',JSON.stringify(entries)); renderAll(); } }
    function deleteMember(i) { if(confirm("Delete Member?")) { members.splice(i,1); localStorage.setItem('jsc_members',JSON.stringify(members)); renderAll(); } }
    function deleteCategory(i) { if(confirm("Delete Category?")) { categories.splice(i,1); localStorage.setItem('jsc_cats',JSON.stringify(categories)); renderAll(); } }
    function editUnitName() { let n = prompt("Unit Name:", unitName); if(n) { unitName = n; localStorage.setItem('unit_title', n); renderAll(); } }

    renderAll();
</script>
</body>
</html>
