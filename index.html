<!<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSC Fund Manager Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --primary: #1a73e8; --income: #2ecc71; --expense: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .unit-header { text-align: center; font-weight: bold; padding: 12px; cursor: pointer; background: #e8f0fe; border-radius: 10px; margin-bottom: 20px; color: var(--primary); border: 2px dashed #1a73e8; }
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .card { padding: 15px; border-radius: 12px; color: white; text-align: center; font-size: 13px; font-weight: bold; }
        .card.in { background: var(--income); }
        .card.out { background: var(--expense); }
        .card.bal { background: var(--primary); }
        .section { background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 25px; }
        input, select, button { padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 15px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .list-box { background: white; border-radius: 8px; border: 1px solid #eee; margin-bottom: 15px; max-height: 180px; overflow-y: auto; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .status-icon { font-size: 18px; margin-right: 5px; }
        .btn-pdf { background: #e74c3c; margin-top: 5px; }
        .btn-wa { background: #25D366; margin-top: 10px; }
        .share-btn { background: #25D366; color: white; padding: 5px 8px; text-decoration: none; border-radius: 5px; font-size: 11px; display: inline-block; }
    </style>
</head>
<body>

<div class="container">
    <div class="unit-header" id="unitDisplay" onclick="editUnitName()">JSC Konganamkode Unit</div>
    
    <div class="dashboard">
        <div class="card in">‡¥µ‡¥∞‡¥µ‡µç<br><span id="totalIn">0</span></div>
        <div class="card out">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><span id="totalOut">0</span></div>
        <div class="card bal">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><span id="balance">0</span></div>
    </div>

    <div class="section">
        <h3>‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µÅ‡¥ï‡µæ (Transactions)</h3>
        <div style="overflow-x:auto;">
            <table id="reportTable">
                <tbody id="ledgerBody"></tbody>
            </table>
        </div>
        <hr style="margin:15px 0;">
        <input type="date" id="date">
        <select id="catSelect"></select>
        <select id="nameSelect"></select>
        <input type="number" id="amt" placeholder="‡¥§‡µÅ‡¥ï">
        <select id="type">
            <option value="income">‡¥µ‡¥∞‡¥µ‡µç (Cash Received ‚úÖ)</option>
            <option value="expense">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Payment Out ‚ùå)</option>
        </select>
        <button onclick="addEntry()">Save & Send Receipt</button>
    </div>

    <div class="section">
        <h3>‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Reports)</h3>
        <button class="btn-wa" onclick="shareFullReport()">WhatsApp Full Report</button>
        <button class="btn-pdf" onclick="exportPDF()">Download PDF Report</button>
        <button style="background: #1d6f42; margin-top:5px;" onclick="exportToExcel()">Download Excel</button>
    </div>

    <div class="section">
        <h3>‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº & ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ</h3>
        <div id="memberListUI" class="list-box"></div>
        <input type="text" id="mName" placeholder="‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº ‡¥™‡µá‡¥∞‡µç">
        <input type="number" id="mPhone" placeholder="‡¥´‡µã‡µ∫">
        <button onclick="addMember()" style="background: var(--income);">Add Member</button>
        <br><br>
        <div id="categoryListUI" class="list-box"></div>
        <input type="text" id="newCat" placeholder="‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥®‡¥Ç">
        <button onclick="addCategory()" style="background: var(--income);">Add Item</button>
    </div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem('jsc_pro_data')) || [];
    let members = JSON.parse(localStorage.getItem('jsc_members')) || [];
    let categories = JSON.parse(localStorage.getItem('jsc_cats')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø", "‡¥ú‡¥ø‡¥≤‡¥æ‡¥®‡¥ø ‡¥∑‡µÜ‡¥∞‡µÄ‡¥´‡µç"];
    let unitName = localStorage.getItem('unit_title') || "JSC Konganamkode Unit";

    function editUnitName() {
        let n = prompt("Unit Name:", unitName);
        if(n) { unitName = n; localStorage.setItem('unit_title', n); renderAll(); }
    }

    function renderAll() {
        document.getElementById('unitDisplay').innerText = unitName;
        document.getElementById('categoryListUI').innerHTML = categories.map((c, i) => `<div class="list-item">${c} <span style="color:red; cursor:pointer;" onclick="deleteCategory(${i})">X</span></div>`).join('');
        document.getElementById('memberListUI').innerHTML = members.map((m, i) => `<div class="list-item">${m.name} <span style="color:red; cursor:pointer;" onclick="deleteMember(${i})">X</span></div>`).join('');
        document.getElementById('catSelect').innerHTML = '<option value="">‡¥á‡¥®‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('nameSelect').innerHTML = '<option value="">‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + members.map(m => `<option value="${m.name}|${m.phone}">${m.name}</option>`).join('');

        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';
        let tin = 0, tout = 0;

        entries.slice().reverse().forEach((e, i) => {
            let actualIndex = entries.length - 1 - i;
            let isInc = e.type === 'income';
            if(isInc) tin += parseFloat(e.amt); else tout += parseFloat(e.amt);
            
            tbody.innerHTML += `<tr>
                <td><span class="status-icon">${isInc ? '‚úÖ' : '‚ùå'}</span></td>
                <td><b>${e.name}</b><br><small>${e.date} | ${e.category}</small></td>
                <td style="color:${isInc ? 'green' : 'red'}">‚Çπ${e.amt}</td>
                <td><span onclick="deleteEntry(${actualIndex})" style="color:red; cursor:pointer;">üóëÔ∏è</span></td>
            </tr>`;
        });

        document.getElementById('totalIn').innerText = tin;
        document.getElementById('totalOut').innerText = tout;
        document.getElementById('balance').innerText = tin - tout;
    }

    function addEntry() {
        const d = document.getElementById('date').value;
        const c = document.getElementById('catSelect').value;
        const m = document.getElementById('nameSelect').value.split('|');
        const a = document.getElementById('amt').value;
        const t = document.getElementById('type').value;
        if(d && c && m[0] && a) {
            entries.push({date:d, category:c, name:m[0], phone:m[1], amt:a, type:t});
            localStorage.setItem('jsc_pro_data', JSON.stringify(entries));
            renderAll();
            let msg = `*${unitName}*\n\n‡¥™‡µç‡¥∞‡¥ø‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥∏‡µç‡¥µ‡µÄ‡¥ï‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
            window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
        }
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text(unitName + " - Fund Report", 14, 15);
        let rows = entries.map(e => [e.date, e.name, e.category, e.amt, e.type === 'income' ? 'Received' : 'Paid']);
        doc.autoTable({ head: [['Date', 'Name', 'Category', 'Amount', 'Status']], body: rows, startY: 25 });
        doc.save("Report.pdf");
    }

    function addMember() {
        let n = document.getElementById('mName').value;
        let p = document.getElementById('mPhone').value;
        if(n && p) { members.push({name:n, phone:p}); localStorage.setItem('jsc_members', JSON.stringify(members)); renderAll(); }
    }

    function addCategory() {
        let c = document.getElementById('newCat').value;
        if(c) { categories.push(c); localStorage.setItem('jsc_cats', JSON.stringify(categories)); renderAll(); }
    }

    function deleteEntry(i) { if(confirm("Delete?")) { entries.splice(i,1); localStorage.setItem('jsc_pro_data',JSON.stringify(entries)); renderAll(); } }
    function deleteMember(i) { members.splice(i,1); localStorage.setItem('jsc_members',JSON.stringify(members)); renderAll(); }
    function deleteCategory(i) { categories.splice(i,1); localStorage.setItem('jsc_cats',JSON.stringify(categories)); renderAll(); }

    function shareFullReport() {
        let txt = `*${unitName} - ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç*\n‡¥µ‡¥∞‡¥µ‡µç: ‚Çπ${document.getElementById('totalIn').innerText} ‚úÖ\n‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${document.getElementById('totalOut').innerText} ‚ùå\n‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø: ‚Çπ${document.getElementById('balance').innerText}\n\n*‡¥Ö‡¥µ‡¥∏‡¥æ‡¥® ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µÅ‡¥ï‡µæ:*`;
        entries.slice(-5).forEach(e => txt += `\n‚Ä¢ ${e.name}: ‚Çπ${e.amt}`);
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    function exportToExcel() {
        let csv = "Date,Name,Category,Amount,Type\n" + entries.map(e => `${e.date},${e.name},${e.category},${e.amt},${e.type}`).join("\n");
        let blob = new Blob([csv], {type: 'text/csv'});
        let link = document.createElement('a');
        link.href = URL.createObjectURL(blob); link.download = 'Report.csv'; link.click();
    }

    renderAll();
</script>
</body>
</html>
