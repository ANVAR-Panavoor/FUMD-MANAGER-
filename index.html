<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSC Fund Manager Pro</title>
    <style>
        :root { --primary: #075e54; --income: #25d366; --expense: #e74c3c; --bg: #ece5dd; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; }
        
        /* ‡¥π‡µÜ‡¥°‡µº */
        .header { background: var(--primary); color: white; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 15px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        
        /* ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µÅ‡¥ï‡µæ */
        .card { background: white; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid #ddd; }
        .card-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #fff; font-weight: bold; color: #333; }
        .card-content { padding: 15px; display: none; border-top: 1px solid #eee; }
        
        /* ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µç ‡¥§‡µÅ‡¥±‡¥ï‡µç‡¥ï‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ */
        .card.active .card-content { display: block; }
        .card.active .card-header { background: #f9f9f9; }

        /* ‡¥ï‡¥£‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡µæ (Stats) */
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 15px; }
        .stat-box { padding: 10px; border-radius: 8px; color: white; text-align: center; font-size: 11px; font-weight: bold; }

        /* ‡¥á‡µª‡¥™‡µÅ‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ */
        input, select, button { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        
        /* ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥∞‡µÄ‡¥§‡¥ø */
        .list-box { background: #f9f9f9; border-radius: 8px; max-height: 180px; overflow-y: auto; margin-bottom: 10px; border: 1px solid #eee; }
        .list-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; align-items: center; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        td { padding: 10px 5px; border-bottom: 1px solid #eee; }
        
        .no-print { display: block; }
        @media print { .no-print { display: none; } .card-content { display: block !important; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header" onclick="editUnitName()">
        <h2 id="uTitle" style="margin:0; font-size: 20px;">JSC KONGANAMKODE UNIT</h2>
        <small>Fund Manager Pro</small>
    </div>

    <div class="card active" id="c1">
        <div class="card-header" onclick="toggleBox('c1')">üìä ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥ï‡µæ (Reports) <span>‚ñº</span></div>
        <div class="card-content">
            <div style="display: flex; gap: 5px; margin-bottom: 10px;" class="no-print">
                <div style="flex:1"><small>From:</small><input type="date" id="fromDate" onchange="renderAll()"></div>
                <div style="flex:1"><small>To:</small><input type="date" id="toDate" onchange="renderAll()"></div>
            </div>
            <div class="stats">
                <div class="stat-box" style="background:var(--income)">‡¥µ‡¥∞‡¥µ‡µç<br><b id="tIn">0</b></div>
                <div class="stat-box" style="background:var(--expense)">‡¥ö‡µÜ‡¥≤‡¥µ‡µç<br><b id="tOut">0</b></div>
                <div class="stat-box" style="background:var(--primary)">‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø<br><b id="tBal">0</b></div>
            </div>
            <table><tbody id="ledgerBody"></tbody></table>
            <button onclick="shareReport()" style="background:#25d366; margin-top:10px;" class="no-print">WhatsApp Share</button>
        </div>
    </div>

    <div class="card" id="c2">
        <div class="card-header" onclick="toggleBox('c2')">üìù ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥ü‡¥™‡¥æ‡¥ü‡µç (Add Entry) <span>‚ñº</span></div>
        <div class="card-content">
            <input type="date" id="inpDate">
            <select id="selCat"></select>
            <select id="selMem"></select>
            <input type="number" id="inpAmt" placeholder="‡¥§‡µÅ‡¥ï (Amount)">
            <select id="selType">
                <option value="in">‡¥µ‡¥∞‡¥µ‡µç (Income ‚úÖ)</option>
                <option value="out">‡¥ö‡µÜ‡¥≤‡¥µ‡µç (Expense ‚ùå)</option>
            </select>
            <button onclick="saveEntry()">Save & Send Receipt</button>
        </div>
    </div>

    <div class="card" id="c3">
        <div class="card-header" onclick="toggleBox('c3')">üìÇ ‡¥´‡¥£‡µç‡¥ü‡µç ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ (Items) <span>‚ñº</span></div>
        <div class="card-content">
            <div id="catListUI" class="list-box"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="newCatName" placeholder="‡¥™‡µÅ‡¥§‡¥ø‡¥Ø ‡¥á‡¥®‡¥Ç">
                <button onclick="addNewCat()" style="width:70px; background:var(--income)">Add</button>
            </div>
        </div>
    </div>

    <div class="card" id="c4">
        <div class="card-header" onclick="toggleBox('c4')">üë• ‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº‡¥Æ‡¥æ‡µº (Members) <span>‚ñº</span></div>
        <div class="card-content">
            <div id="memListUI" class="list-box"></div>
            <input type="text" id="newMemName" placeholder="‡¥™‡µá‡¥∞‡µç">
            <input type="number" id="newMemPhone" placeholder="‡¥µ‡¥æ‡¥ü‡µç‡¥∏‡¥æ‡¥™‡µç‡¥™‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº">
            <button onclick="addNewMem()" style="background:var(--income)">Add Member</button>
        </div>
    </div>
</div>

<script>
    // ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
    let transactions = JSON.parse(localStorage.getItem('jsc_trans_v3')) || [];
    let membersList = JSON.parse(localStorage.getItem('jsc_mems_v3')) || [];
    let categoriesList = JSON.parse(localStorage.getItem('jsc_cats_v3')) || ["‡¥Æ‡¥æ‡¥∏‡¥µ‡¥∞‡¥ø"];
    let unitTitle = localStorage.getItem('jsc_unit_v3') || "JSC KONGANAMKODE UNIT";

    // ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µç ‡¥ü‡µã‡¥ó‡¥ø‡µæ ‡¥´‡¥ô‡µç‡¥ï‡µç‡¥∑‡µª
    function toggleBox(id) {
        document.getElementById(id).classList.toggle('active');
    }

    // ‡¥™‡µá‡¥ú‡µç ‡¥≤‡µã‡¥°‡µç ‡¥Ü‡¥ï‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µá‡¥£‡µç‡¥ü‡¥µ
    window.onload = function() {
        document.getElementById('inpDate').value = new Date().toISOString().split('T')[0];
        renderAll();
    };

    function renderAll() {
        document.getElementById('uTitle').innerText = unitTitle;
        
        // ‡¥á‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç
        document.getElementById('catListUI').innerHTML = categoriesList.map((c, i) => 
            `<div class="list-item">${c} <span onclick="delCat(${i})" style="color:red; cursor:pointer;">‚úï</span></div>`).join('');
        
        // ‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡µº ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç
        document.getElementById('memListUI').innerHTML = membersList.map((m, i) => 
            `<div class="list-item">${m.n} <span onclick="delMem(${i})" style="color:red; cursor:pointer;">‚úï</span></div>`).join('');

        // ‡¥∏‡µÜ‡¥≤‡¥ï‡µç‡¥ü‡µç ‡¥¨‡µã‡¥ï‡µç‡¥∏‡µÅ‡¥ï‡µæ
        document.getElementById('selCat').innerHTML = '<option value="">‡¥á‡¥®‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + 
            categoriesList.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('selMem').innerHTML = '<option value="">‡¥Æ‡µÜ‡¥Æ‡µç‡¥™‡¥±‡µÜ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>' + 
            membersList.map(m => `<option value="${m.n}|${m.p}">${m.n}</option>`).join('');

        // ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç ‡¥´‡¥ø‡µΩ‡¥ü‡µç‡¥ü‡¥±‡¥ø‡¥Ç‡¥ó‡µç
        const fromD = document.getElementById('fromDate').value;
        const toD = document.getElementById('toDate').value;
        const tbody = document.getElementById('ledgerBody');
        tbody.innerHTML = '';
        
        let totalIn = 0, totalOut = 0;

        transactions.forEach((t, idx) => {
            if ((fromD && t.d < fromD) || (toD && t.d > toD)) return;

            if (t.type === 'in') totalIn += parseFloat(t.a);
            else totalOut += parseFloat(t.a);

            let row = `<tr>
                <td><b>${t.n}</b><br><small>${t.d} | ${t.c}</small></td>
                <td style="color:${t.type=='in'?'green':'red'}">‚Çπ${t.a}</td>
                <td class="no-print"><span onclick="delTrans(${idx})" style="cursor:pointer;">üóëÔ∏è</span></td>
            </tr>`;
            tbody.innerHTML = row + tbody.innerHTML;
        });

        document.getElementById('tIn').innerText = totalIn;
        document.getElementById('tOut').innerText = totalOut;
        document.getElementById('tBal').innerText = totalIn - totalOut;
    }

    function saveEntry() {
        let d = document.getElementById('inpDate').value;
        let c = document.getElementById('selCat').value;
        let m = document.getElementById('selMem').value.split('|');
        let a = document.getElementById('inpAmt').value;
        let type = document.getElementById('selType').value;

        if (d && c && m[0] && a) {
            transactions.push({ d, c, n: m[0], p: m[1], a, type });
            localStorage.setItem('jsc_trans_v3', JSON.stringify(transactions));
            renderAll();
            if (confirm("‡¥∏‡µá‡¥µ‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µÅ! ‡¥∞‡¥∏‡µÄ‡¥§‡µç ‡¥Ö‡¥Ø‡¥ï‡µç‡¥ï‡¥£‡µã?")) {
                let msg = `*${unitTitle}*\n\n‡¥™‡µç‡¥∞‡¥ø‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü ${m[0]},\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‚Çπ${a} (${c}) ‡¥≤‡¥≠‡¥ø‡¥ö‡µç‡¥ö‡µÅ. ‚úÖ\n‡¥®‡¥®‡µç‡¥¶‡¥ø.`;
                window.open(`https://wa.me/91${m[1]}?text=${encodeURIComponent(msg)}`);
            }
        } else { alert("‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥™‡µÇ‡µº‡¥£‡µç‡¥£‡¥Æ‡¥≤‡µç‡¥≤!"); }
    }

    function shareReport() {
        let txt = `*${unitTitle} - ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç*\n\n‡¥µ‡¥∞‡¥µ‡µç: ‚Çπ${document.getElementById('tIn').innerText}\n‡¥ö‡µÜ‡¥≤‡¥µ‡µç: ‚Çπ${document.getElementById('tOut').innerText}\n‡¥¨‡¥æ‡¥ï‡µç‡¥ï‡¥ø: ‚Çπ${document.getElementById('tBal').innerText}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
    }

    function addNewMem() {
        let n = document.getElementById('newMemName').value;
        let p = document.getElementById('newMemPhone').value;
        if (n && p) { membersList.push({ n, p }); localStorage.setItem('jsc_mems_v3', JSON.stringify(membersList)); renderAll(); }
    }

    function addNewCat() {
        let c = document.getElementById('newCatName').value;
        if (c) { categoriesList.push(c); localStorage.setItem('jsc_cats_v3', JSON.stringify(categoriesList)); renderAll(); }
    }

    function delTrans(i) { if (confirm("Delete?")) { transactions.splice(i, 1); localStorage.setItem('jsc_trans_v3', JSON.stringify(transactions)); renderAll(); } }
    function delMem(i) { membersList.splice(i, 1); localStorage.setItem('jsc_mems_v3', JSON.stringify(membersList)); renderAll(); }
    function delCat(i) { categoriesList.splice(i, 1); localStorage.setItem('jsc_cats_v3', JSON.stringify(categoriesList)); renderAll(); }
    function editUnitName() { let n = prompt("Unit Name:", unitTitle); if (n) { unitTitle = n; localStorage.setItem('jsc_unit_v3', n); renderAll(); } }

</script>
</body>
</html>
